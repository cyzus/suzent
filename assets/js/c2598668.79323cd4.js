"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[74],{237(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"concepts/memory/architecture","title":"Architecture","description":"System Layers","source":"@site/../docs/02-concepts/memory/architecture.md","sourceDirName":"02-concepts/memory","slug":"/concepts/memory/architecture","permalink":"/suzent/docs/concepts/memory/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/cyzus/suzent/tree/main/website/../docs/02-concepts/memory/architecture.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"API Reference","permalink":"/suzent/docs/concepts/memory/api"},"next":{"title":"Configuration","permalink":"/suzent/docs/concepts/memory/configuration"}}');var i=r(4848),t=r(8453);const c={},l="Architecture",o={},d=[{value:"System Layers",id:"system-layers",level:2},{value:"Components",id:"components",level:2},{value:"LanceDBMemoryStore (lancedb_store.py)",id:"lancedbmemorystore-lancedb_storepy",level:3},{value:"MemoryManager (manager.py)",id:"memorymanager-managerpy",level:3},{value:"Memory Tools (tools.py)",id:"memory-tools-toolspy",level:3},{value:"Memory Context (memory_context.py)",id:"memory-context-memory_contextpy",level:3},{value:"Data Flow",id:"data-flow",level:2},{value:"Read Path (Memory Injection)",id:"read-path-memory-injection",level:3},{value:"Write Path (Extraction)",id:"write-path-extraction",level:3},{value:"Tool Usage",id:"tool-usage",level:3},{value:"Memory Scoping",id:"memory-scoping",level:2},{value:"User-Level",id:"user-level",level:3},{value:"Chat-Level",id:"chat-level",level:3},{value:"Global",id:"global",level:3},{value:"Priority",id:"priority",level:3},{value:"File Structure",id:"file-structure",level:2},{value:"Design Principles",id:"design-principles",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,i.jsx)(n.h2,{id:"system-layers",children:"System Layers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Agent Tools                \u2502  memory_search, memory_block_update\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      MemoryManager              \u2502  Orchestration & extraction\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      LanceDBMemoryStore         \u2502  Storage operations\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      LanceDB                    \u2502  Vector & full-text storage\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,i.jsx)(n.h3,{id:"lancedbmemorystore-lancedb_storepy",children:"LanceDBMemoryStore (lancedb_store.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Storage layer"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Responsibilities:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"LanceDB connection management"}),"\n",(0,i.jsx)(n.li,{children:"Core memory block CRUD"}),"\n",(0,i.jsx)(n.li,{children:"Archival memory with vector embeddings"}),"\n",(0,i.jsx)(n.li,{children:"Semantic and hybrid search (vector + full-text)"}),"\n",(0,i.jsx)(n.li,{children:"Statistics"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"get_all_memory_blocks()"})," - Retrieve with scoping priority"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"add_memory()"})," - Store with embedding"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"semantic_search()"})," - Pure vector similarity"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hybrid_search()"})," - Combined vector + FTS scoring"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scoping:"})," chat-specific > user-level > global"]}),"\n",(0,i.jsx)(n.h3,{id:"memorymanager-managerpy",children:"MemoryManager (manager.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Orchestration layer"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Responsibilities:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Core memory formatting"}),"\n",(0,i.jsx)(n.li,{children:"Automatic fact extraction"}),"\n",(0,i.jsx)(n.li,{children:"Deduplication"}),"\n",(0,i.jsx)(n.li,{children:"Embedding generation"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"get_core_memory()"})," - All blocks with defaults"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"format_core_memory_for_context()"})," - Prompt injection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"retrieve_relevant_memories()"})," - Auto-retrieval"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process_conversation_turn_for_memories()"})," - Extract from full context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"refresh_core_memory_facts()"})," - Auto-summarize core memory"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"search_memories()"})," - Agent-facing search"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Extraction Process:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Full Conversation Turn (User + Agent Steps + Response)"}),"\n",(0,i.jsx)(n.li,{children:'LLM extraction with "Rich Context" prompts'}),"\n",(0,i.jsx)(n.li,{children:"Deduplication check"}),"\n",(0,i.jsx)(n.li,{children:"Store unique facts"}),"\n",(0,i.jsx)(n.li,{children:"Monitor for high-importance facts -> Trigger Core Memory Refresh"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"memory-tools-toolspy",children:"Memory Tools (tools.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Agent interface"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"MemorySearchTool:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Semantic search across archival"}),"\n",(0,i.jsx)(n.li,{children:"Formatted results with scores"}),"\n",(0,i.jsx)(n.li,{children:"Thread-safe execution"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"MemoryBlockUpdateTool:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Update core blocks"}),"\n",(0,i.jsx)(n.li,{children:"Operations: replace, append, search_replace"}),"\n",(0,i.jsx)(n.li,{children:"Auto-scoping (user vs chat level)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Thread Safety:"}),"\nUses ",(0,i.jsx)(n.code,{children:"asyncio.run_coroutine_threadsafe()"})," for safe execution from worker threads."]}),"\n",(0,i.jsx)(n.h3,{id:"memory-context-memory_contextpy",children:"Memory Context (memory_context.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Prompt templates"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"format_core_memory_section()"})," - Agent context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"format_retrieved_memories_section()"})," - Search results with intent/outcome"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FACT_EXTRACTION_SYSTEM_PROMPT"})," - Rich extraction instructions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CORE_MEMORY_SUMMARIZATION_PROMPT"})," - Auto-summary instructions"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,i.jsx)(n.h3,{id:"read-path-memory-injection",children:"Read Path (Memory Injection)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User Query\n  \u2193\nmanager.retrieve_relevant_memories()\n  \u2193\nGenerate embedding \u2192 Hybrid search\n  \u2193\nFormat results (Content + Context + Outcome)\n  \u2193\nInject into agent prompt\n"})}),"\n",(0,i.jsx)(n.h3,{id:"write-path-extraction",children:"Write Path (Extraction)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Conversation Turn (User + Agent + Response)\n  \u2193\nmanager.process_conversation_turn_for_memories()\n  \u2193\nLLM extracts facts + context\n  \u2193\nStore unique facts\n  \u2193\nIf High Importance -> refresh_core_memory_facts()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tool-usage",children:"Tool Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Agent decides to search\n  \u2193\nCalls memory_search(query)\n  \u2193\nExecute in main loop\n  \u2193\nReturn formatted results\n"})}),"\n",(0,i.jsx)(n.h2,{id:"memory-scoping",children:"Memory Scoping"}),"\n",(0,i.jsx)(n.h3,{id:"user-level",children:"User-Level"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope:"})," All chats"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage:"})," ",(0,i.jsx)(n.code,{children:'user_id="x", chat_id=NULL'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use:"})," Preferences, facts, persona"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"chat-level",children:"Chat-Level"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope:"})," Single conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage:"})," ",(0,i.jsx)(n.code,{children:'user_id="x", chat_id="y"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use:"})," Current context, session state"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"global",children:"Global"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope:"})," All users/chats"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage:"})," ",(0,i.jsx)(n.code,{children:"user_id=NULL, chat_id=NULL"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use:"})," Default persona"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"priority",children:"Priority"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Chat-specific (most specific)"}),"\n",(0,i.jsx)(n.li,{children:"User-level (persistent)"}),"\n",(0,i.jsx)(n.li,{children:"Global (fallback)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"src/suzent/memory/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 lancedb_store.py     # Storage layer\n\u251c\u2500\u2500 manager.py           # Orchestration\n\u251c\u2500\u2500 memory_context.py    # Templates\n\u251c\u2500\u2500 tools.py             # Agent interface\n\u251c\u2500\u2500 models.py            # Pydantic models\n\u2514\u2500\u2500 lifecycle.py         # Initialization\n"})}),"\n",(0,i.jsx)(n.h2,{id:"design-principles",children:"Design Principles"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Separation of Concerns"})," - Clear layer boundaries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Async by Default"})," - Non-blocking I/O"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Flexible Scoping"})," - Automatic priority resolution"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automatic Management"})," - Facts extracted without commands"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Production Ready"})," - File-based storage with vector + FTS indexing"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>c,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);