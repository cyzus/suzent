"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[695],{4940(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"concepts/memory/troubleshooting","title":"Troubleshooting","description":"Storage Issues","source":"@site/../docs/02-concepts/memory/troubleshooting.md","sourceDirName":"02-concepts/memory","slug":"/concepts/memory/troubleshooting","permalink":"/docs/concepts/memory/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/cyzus/suzent/tree/main/website/../docs/02-concepts/memory/troubleshooting.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Configuration","permalink":"/docs/concepts/memory/configuration"},"next":{"title":"Suzent Nodes Guide","permalink":"/docs/concepts/nodes/"}}');var i=r(4848),t=r(8453);const o={},l="Troubleshooting",a={},c=[{value:"Storage Issues",id:"storage-issues",level:2},{value:"Permission Denied Errors",id:"permission-denied-errors",level:3},{value:"Storage Not Found",id:"storage-not-found",level:3},{value:"Vector Dimension Mismatch",id:"vector-dimension-mismatch",level:2},{value:"Slow Search Performance",id:"slow-search-performance",level:2},{value:"No Memories Extracted",id:"no-memories-extracted",level:2},{value:"Storage Size Issues",id:"storage-size-issues",level:2},{value:"High Disk Usage",id:"high-disk-usage",level:3},{value:"Import Errors",id:"import-errors",level:2},{value:"Embedding Generation Fails",id:"embedding-generation-fails",level:2},{value:"Connection/Initialization Errors",id:"connectioninitialization-errors",level:2},{value:"Data Migration",id:"data-migration",level:2},{value:"Moving from PostgreSQL to LanceDB",id:"moving-from-postgresql-to-lancedb",level:3},{value:"Getting Help",id:"getting-help",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"troubleshooting",children:"Troubleshooting"})}),"\n",(0,i.jsx)(n.h2,{id:"storage-issues",children:"Storage Issues"}),"\n",(0,i.jsx)(n.h3,{id:"permission-denied-errors",children:"Permission Denied Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," ",(0,i.jsx)(n.code,{children:"PermissionError: [Errno 13] Permission denied: '.suzent/data/memory'"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Insufficient permissions to create or access LanceDB storage directory."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check directory permissions\nls -la .suzent/data/\n\n# Fix permissions (Linux/Mac)\nchmod -R 755 .suzent/data/memory\n\n# Windows: Right-click folder \u2192 Properties \u2192 Security \u2192 Edit permissions\n"})}),"\n",(0,i.jsx)(n.h3,{id:"storage-not-found",children:"Storage Not Found"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," ",(0,i.jsx)(n.code,{children:"Directory not found"})," or initialization failures"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," LanceDB URI path doesn't exist or is misconfigured."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pathlib import Path\n\n# Ensure directory exists\nstorage_path = Path(".suzent/data/memory")\nstorage_path.mkdir(parents=True, exist_ok=True)\n\n# Then initialize store\nstore = LanceDBMemoryStore(uri=str(storage_path))\n'})}),"\n",(0,i.jsx)(n.h2,{id:"vector-dimension-mismatch",children:"Vector Dimension Mismatch"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," ",(0,i.jsx)(n.code,{children:"Dimension mismatch: expected 3072, got 1536"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Embedding model dimension doesn't match configured dimension."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Option 1: Update config to match model\n# If using text-embedding-3-small (1536 dimensions)\nstore = LanceDBMemoryStore(\n    uri=".suzent/data/memory",\n    embedding_dim=1536\n)\n\nmanager = MemoryManager(\n    store=store,\n    embedding_model="text-embedding-3-small",\n    embedding_dimension=1536\n)\n\n# Option 2: Clear existing data and rebuild\n# Delete the storage directory\nimport shutil\nshutil.rmtree(".suzent/data/memory")\n# Reinitialize with correct dimensions\n'})}),"\n",(0,i.jsx)(n.h2,{id:"slow-search-performance",children:"Slow Search Performance"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symptoms:"})," Search taking >2 seconds"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Diagnosis:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check table size:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pathlib import Path\n\ndb_path = Path(".suzent/data/memory")\ntotal_size = sum(f.stat().st_size for f in db_path.rglob(\'*\') if f.is_file())\nprint(f"Storage size: {total_size / (1024**2):.2f} MB")\n\n# Count memories\ncount = await store.get_memory_count(user_id="your-user-id")\nprint(f"Total memories: {count}")\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Check if search parameters are too broad:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Use stricter filters\nresults = await manager.search_memories(\n    query="...",\n    user_id="specific-user",\n    chat_id="specific-chat",  # Add chat scope\n    limit=5  # Reduce limit\n)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Optimize search parameters:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Use hybrid search with adjusted weights\nresults = await store.hybrid_search(\n    query_embedding=embedding,\n    query_text=query,\n    user_id=user_id,\n    limit=10,\n    semantic_weight=0.8,  # Prioritize vector search\n    fts_weight=0.2\n)\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Compact storage:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# LanceDB automatically optimizes, but you can force cleanup\n# by deleting and rebuilding storage if needed\n"})}),"\n",(0,i.jsx)(n.h2,{id:"no-memories-extracted",children:"No Memories Extracted"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Checks:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"LLM configured?"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'manager = MemoryManager(\n    store=store,\n    llm_for_extraction="gpt-4o-mini"  # Must be set for LLM extraction\n)\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Memory system enabled?"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from suzent.config import CONFIG\nprint(f"Memory enabled: {CONFIG.memory_enabled}")\nprint(f"Extraction model: {CONFIG.extraction_model}")\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Processing conversation turns?"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Ensure you\'re using process_conversation_turn_for_memories\nfrom suzent.memory.models import ConversationTurn, Message\n\nturn = ConversationTurn(\n    user_message=Message(role="user", content="..."),\n    assistant_message=Message(role="assistant", content="..."),\n    agent_actions=[...]\n)\n\nresult = await manager.process_conversation_turn_for_memories(\n    conversation_turn=turn,\n    chat_id="chat-id",\n    user_id="user-id"\n)\nprint(f"Extracted: {result.extracted_facts}")\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"API key set?"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo $OPENAI_API_KEY\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Debug logging:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import logging\nlogging.basicConfig(level=logging.DEBUG)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"storage-size-issues",children:"Storage Size Issues"}),"\n",(0,i.jsx)(n.h3,{id:"high-disk-usage",children:"High Disk Usage"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Check size:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pathlib import Path\n\ndb_path = Path(".suzent/data/memory")\ntotal_size = sum(f.stat().st_size for f in db_path.rglob(\'*\') if f.is_file())\nprint(f"Memory storage: {total_size / (1024**2):.2f} MB")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Delete old low-importance memories:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Get all memories sorted by importance\nmemories = await store.list_memories(\n    user_id=\"user-id\",\n    order_by=\"importance\",\n    order_desc=False,  # Lowest first\n    limit=100\n)\n\n# Delete low-importance old memories\nfor mem in memories:\n    if mem['importance'] < 0.3 and mem['access_count'] < 2:\n        await store.delete_memory(mem['id'])\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Clear all memories for a user:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'await store.delete_all_memories(user_id="user-id")\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Clear entire storage:"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import shutil\nshutil.rmtree(".suzent/data/memory")\n# Reinitialize\nstore = LanceDBMemoryStore(uri=".suzent/data/memory")\nawait store.connect()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"import-errors",children:"Import Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," ",(0,i.jsx)(n.code,{children:"ModuleNotFoundError: No module named 'suzent.memory'"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Install:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"uv sync\n# or\npip install -e .\n"})}),"\n",(0,i.jsx)(n.h2,{id:"embedding-generation-fails",children:"Embedding Generation Fails"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," ",(0,i.jsx)(n.code,{children:"OpenAI API error"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Checks:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"API key valid"}),"\n",(0,i.jsx)(n.li,{children:"Billing enabled"}),"\n",(0,i.jsx)(n.li,{children:"Rate limits not exceeded"}),"\n",(0,i.jsx)(n.li,{children:"Network connectivity"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Retry with backoff:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from tenacity import retry, wait_exponential\n\n@retry(wait=wait_exponential(multiplier=1, min=2, max=10))\nasync def generate_with_retry(text):\n    return await embedding_gen.generate(text)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"connectioninitialization-errors",children:"Connection/Initialization Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error:"})," ",(0,i.jsx)(n.code,{children:"Failed to initialize memory system"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Debug:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import logging\nlogging.basicConfig(level=logging.DEBUG)\n\nfrom suzent.memory import init_memory_system\n\n# Check initialization\nsuccess = await init_memory_system()\nprint(f"Memory system initialized: {success}")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Storage path not writable"}),"\n",(0,i.jsx)(n.li,{children:"Embedding dimension mismatch"}),"\n",(0,i.jsx)(n.li,{children:"Missing dependencies (lancedb, pyarrow)"}),"\n",(0,i.jsx)(n.li,{children:"Configuration errors"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fix dependencies:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install lancedb pyarrow\n"})}),"\n",(0,i.jsx)(n.h2,{id:"data-migration",children:"Data Migration"}),"\n",(0,i.jsx)(n.h3,{id:"moving-from-postgresql-to-lancedb",children:"Moving from PostgreSQL to LanceDB"}),"\n",(0,i.jsx)(n.p,{children:"If you have existing PostgreSQL data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Export from PostgreSQL\nold_store = PostgresMemoryStore(connection_string)\nawait old_store.connect()\nmemories = await old_store.list_memories(user_id=\"user-id\", limit=10000)\n\n# Import to LanceDB\nnew_store = LanceDBMemoryStore(uri=\".suzent/data/memory\")\nawait new_store.connect()\n\nfor mem in memories:\n    await new_store.add_memory(\n        content=mem['content'],\n        embedding=mem['embedding'],\n        user_id=mem['user_id'],\n        chat_id=mem.get('chat_id'),\n        metadata=mem.get('metadata', {}),\n        importance=mem.get('importance', 0.5)\n    )\n"})}),"\n",(0,i.jsx)(n.h2,{id:"getting-help",children:"Getting Help"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Enable debug logging"}),"\n",(0,i.jsx)(n.li,{children:"Check logs for errors"}),"\n",(0,i.jsx)(n.li,{children:"Verify configuration matches documentation"}),"\n",(0,i.jsx)(n.li,{children:"Open issue with: error message, config, logs"}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);