"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[837],{5891(e,n,s){s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>l});const d=JSON.parse('{"id":"concepts/nodes/nodes","title":"Suzent Nodes Guide","description":"This guide covers the node system in Suzent \u2014 how to connect companion devices and control them remotely.","source":"@site/../docs/02-concepts/nodes/nodes.md","sourceDirName":"02-concepts/nodes","slug":"/concepts/nodes/","permalink":"/docs/concepts/nodes/","draft":false,"unlisted":false,"editUrl":"https://github.com/cyzus/suzent/tree/main/website/../docs/02-concepts/nodes/nodes.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting","permalink":"/docs/concepts/memory/troubleshooting"},"next":{"title":"Suzent Skills Guide","permalink":"/docs/concepts/skills/"}}');var o=s(4848),i=s(8453);const t={},c="Suzent Nodes Guide",r={},l=[{value:"Overview",id:"overview",level:2},{value:"Key Concepts",id:"key-concepts",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Using Nodes via CLI",id:"using-nodes-via-cli",level:2},{value:"List Connected Nodes",id:"list-connected-nodes",level:3},{value:"Check Connectivity",id:"check-connectivity",level:3},{value:"Describe a Node&#39;s Capabilities",id:"describe-a-nodes-capabilities",level:3},{value:"Invoke a Command",id:"invoke-a-command",level:3},{value:"WebSocket Protocol",id:"websocket-protocol",level:2},{value:"1. Handshake",id:"1-handshake",level:3},{value:"2. Command Invocation",id:"2-command-invocation",level:3},{value:"3. Heartbeat",id:"3-heartbeat",level:3},{value:"Building a Node Client",id:"building-a-node-client",level:2},{value:"Python Example",id:"python-example",level:3},{value:"Configuration",id:"configuration",level:2},{value:"REST API",id:"rest-api",level:2},{value:"Pydantic Models",id:"pydantic-models",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Server error: 404&quot; on <code>suzent nodes list</code>",id:"server-error-404-on-suzent-nodes-list",level:3},{value:"Node disconnects immediately",id:"node-disconnects-immediately",level:3},{value:"Command timeout",id:"command-timeout",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"suzent-nodes-guide",children:"Suzent Nodes Guide"})}),"\n",(0,o.jsx)(n.p,{children:"This guide covers the node system in Suzent \u2014 how to connect companion devices and control them remotely."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"Nodes are companion devices (phones, desktops, headless servers) that connect to the Suzent server via WebSocket and expose capabilities the agent can invoke remotely. Inspired by OpenClaw's distributed control architecture."}),"\n",(0,o.jsx)(n.h3,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Concept"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Node"})}),(0,o.jsx)(n.td,{children:"A connected device that advertises capabilities"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Capability"})}),(0,o.jsxs)(n.td,{children:["A named command a node can handle (e.g., ",(0,o.jsx)(n.code,{children:"camera.snap"}),")"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"NodeManager"})}),(0,o.jsx)(n.td,{children:"Server-side registry that tracks and dispatches to nodes"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"WebSocketNode"})}),(0,o.jsx)(n.td,{children:"Node implementation using WebSocket + JSON-RPC protocol"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     WebSocket       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Companion Node   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502   Suzent Server   \u2502\n\u2502  (Phone/Desktop)  \u2502   JSON-RPC msgs     \u2502   (NodeManager)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                 \u2502 REST API\n                                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                          \u2502   CLI / Agent     \u2502\n                                          \u2502  suzent nodes ... \u2502\n                                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.h2,{id:"using-nodes-via-cli",children:"Using Nodes via CLI"}),"\n",(0,o.jsxs)(n.p,{children:["Nodes are controlled through the ",(0,o.jsx)(n.code,{children:"suzent nodes"})," CLI subcommands. The agent uses these same commands via ",(0,o.jsx)(n.code,{children:"BashTool"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"list-connected-nodes",children:"List Connected Nodes"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"suzent nodes list\n"})}),"\n",(0,o.jsx)(n.h3,{id:"check-connectivity",children:"Check Connectivity"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"suzent nodes status\n"})}),"\n",(0,o.jsx)(n.h3,{id:"describe-a-nodes-capabilities",children:"Describe a Node's Capabilities"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"suzent nodes describe <node_id_or_name>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"invoke-a-command",children:"Invoke a Command"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Option 1: Key-Value Pairs (Simpler)\nsuzent nodes invoke <node> <command> key=value [key2=value2 ...]\n\n# Option 2: JSON Params (Legacy/Complex)\nsuzent nodes invoke <node> <command> --params \'{"key": "value"}\'\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Take a photo (simple)\nsuzent nodes invoke MyPhone camera.snap format=png\n\n# Speak with arguments (inferred types)\nsuzent nodes invoke "Local PC" speaker.speak text="Hello world" prompt=cheerful\n\n# Mixed types (int, boolean)\nsuzent nodes invoke MyNode some.command count=5 verbose=true\n\n# JSON fallback for complex objects\nsuzent nodes invoke MyNode config.update data=\'{"nested": true}\'\n'})}),"\n",(0,o.jsx)(n.h2,{id:"websocket-protocol",children:"WebSocket Protocol"}),"\n",(0,o.jsxs)(n.p,{children:["Nodes connect to the server at ",(0,o.jsx)(n.code,{children:"ws://<host>:<port>/ws/node"})," and follow a JSON-RPC-style message protocol."]}),"\n",(0,o.jsx)(n.h3,{id:"1-handshake",children:"1. Handshake"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Node \u2192 Server"})," (on connect):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "type": "connect",\n  "display_name": "MyPhone",\n  "platform": "ios",\n  "capabilities": [\n    {\n      "name": "camera.snap",\n      "description": "Take a photo with the device camera",\n      "params_schema": {"format": "str", "quality": "float"}\n    }\n  ]\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Server \u2192 Node"})," (acknowledgment):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "type": "connected",\n  "node_id": "a1b2c3d4-..."\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-command-invocation",children:"2. Command Invocation"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Server \u2192 Node"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "type": "invoke",\n  "request_id": "uuid-...",\n  "command": "camera.snap",\n  "params": {"format": "png"}\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Node \u2192 Server"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "type": "result",\n  "request_id": "uuid-...",\n  "success": true,\n  "result": {"file": "/tmp/photo.png"}\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"3-heartbeat",children:"3. Heartbeat"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Server \u2192 Node"}),": ",(0,o.jsx)(n.code,{children:'{"type": "ping"}'}),"\n",(0,o.jsx)(n.strong,{children:"Node \u2192 Server"}),": ",(0,o.jsx)(n.code,{children:'{"type": "pong"}'})]}),"\n",(0,o.jsx)(n.h2,{id:"building-a-node-client",children:"Building a Node Client"}),"\n",(0,o.jsx)(n.p,{children:"To connect a device as a node, implement a WebSocket client that:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Connects to ",(0,o.jsx)(n.code,{children:"ws://<suzent-host>:25314/ws/node"})]}),"\n",(0,o.jsxs)(n.li,{children:["Sends a ",(0,o.jsx)(n.code,{children:"connect"})," message with capabilities"]}),"\n",(0,o.jsxs)(n.li,{children:["Waits for ",(0,o.jsx)(n.code,{children:"connected"})," acknowledgment"]}),"\n",(0,o.jsxs)(n.li,{children:["Listens for ",(0,o.jsx)(n.code,{children:"invoke"})," messages and responds with ",(0,o.jsx)(n.code,{children:"result"})," messages"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"python-example",children:"Python Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import asyncio\nimport json\nimport websockets\n\nasync def run_node():\n    uri = "ws://localhost:25314/ws/node"\n    async with websockets.connect(uri) as ws:\n        # Handshake\n        await ws.send(json.dumps({\n            "type": "connect",\n            "display_name": "MyDevice",\n            "platform": "python",\n            "capabilities": [\n                {"name": "echo", "description": "Echo back a message"},\n            ]\n        }))\n\n        resp = json.loads(await ws.recv())\n        print(f"Connected as {resp[\'node_id\']}")\n\n        # Message loop\n        async for message in ws:\n            data = json.loads(message)\n            if data["type"] == "invoke":\n                # Handle the command\n                result = {"echo": data["params"].get("text", "")}\n                await ws.send(json.dumps({\n                    "type": "result",\n                    "request_id": data["request_id"],\n                    "success": True,\n                    "result": result,\n                }))\n            elif data["type"] == "ping":\n                await ws.send(json.dumps({"type": "pong"}))\n\nasyncio.run(run_node())\n'})}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(n.p,{children:"Node system settings in Suzent configuration:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Field"}),(0,o.jsx)(n.th,{children:"Default"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"nodes_enabled"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"true"})}),(0,o.jsx)(n.td,{children:"Enable/disable node WebSocket connections"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"node_auth_mode"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:'"open"'})}),(0,o.jsxs)(n.td,{children:["Authentication mode: ",(0,o.jsx)(n.code,{children:"open"}),", ",(0,o.jsx)(n.code,{children:"approve"}),", or ",(0,o.jsx)(n.code,{children:"token"})]})]})]})]}),"\n",(0,o.jsx)(n.p,{children:"Modify via CLI:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"suzent config get nodes_enabled\nsuzent config set nodes_enabled true\n"})}),"\n",(0,o.jsx)(n.h2,{id:"rest-api",children:"REST API"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Method"}),(0,o.jsx)(n.th,{children:"Endpoint"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"GET"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/nodes"})}),(0,o.jsx)(n.td,{children:"List all connected nodes"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"GET"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/nodes/{node_id}"})}),(0,o.jsx)(n.td,{children:"Describe a specific node"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"POST"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/nodes/{node_id}/invoke"})}),(0,o.jsx)(n.td,{children:"Invoke a command on a node"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"WS"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"/ws/node"})}),(0,o.jsx)(n.td,{children:"WebSocket endpoint for node connections"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"pydantic-models",children:"Pydantic Models"}),"\n",(0,o.jsxs)(n.p,{children:["All protocol messages and API schemas are defined as Pydantic models in ",(0,o.jsx)(n.code,{children:"src/suzent/nodes/models.py"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Protocol"}),": ",(0,o.jsx)(n.code,{children:"ConnectMessage"}),", ",(0,o.jsx)(n.code,{children:"ConnectedResponse"}),", ",(0,o.jsx)(n.code,{children:"InvokeMessage"}),", ",(0,o.jsx)(n.code,{children:"ResultMessage"}),", ",(0,o.jsx)(n.code,{children:"PingMessage"}),", ",(0,o.jsx)(n.code,{children:"PongMessage"}),", ",(0,o.jsx)(n.code,{children:"EventMessage"}),", ",(0,o.jsx)(n.code,{children:"ErrorResponse"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"API"}),": ",(0,o.jsx)(n.code,{children:"NodeInfo"}),", ",(0,o.jsx)(n.code,{children:"NodeListResponse"}),", ",(0,o.jsx)(n.code,{children:"InvokeRequest"}),", ",(0,o.jsx)(n.code,{children:"InvokeResponse"}),", ",(0,o.jsx)(n.code,{children:"CapabilitySchema"})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(n.h3,{id:"server-error-404-on-suzent-nodes-list",children:['"Server error: 404" on ',(0,o.jsx)(n.code,{children:"suzent nodes list"})]}),"\n",(0,o.jsx)(n.p,{children:"The server was started before the node routes were added. Restart the server."}),"\n",(0,o.jsx)(n.h3,{id:"node-disconnects-immediately",children:"Node disconnects immediately"}),"\n",(0,o.jsxs)(n.p,{children:["Check that the ",(0,o.jsx)(n.code,{children:"connect"})," message has valid JSON with required ",(0,o.jsx)(n.code,{children:"display_name"})," field. Review server logs for handshake errors."]}),"\n",(0,o.jsx)(n.h3,{id:"command-timeout",children:"Command timeout"}),"\n",(0,o.jsxs)(n.p,{children:["Default timeout is 30 seconds. Ensure the node client sends a ",(0,o.jsx)(n.code,{children:"result"})," message with the matching ",(0,o.jsx)(n.code,{children:"request_id"})," promptly."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>c});var d=s(6540);const o={},i=d.createContext(o);function t(e){const n=d.useContext(i);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),d.createElement(i.Provider,{value:n},e.children)}}}]);