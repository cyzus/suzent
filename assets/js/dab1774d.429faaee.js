"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[687],{8347(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>a,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"concepts/automation/automation","title":"Suzent Automation Guide","description":"This guide covers the automation systems in Suzent \u2014 scheduled cron jobs and periodic heartbeat check-ins.","source":"@site/../docs/02-concepts/automation/automation.md","sourceDirName":"02-concepts/automation","slug":"/concepts/automation/","permalink":"/docs/concepts/automation/","draft":false,"unlisted":false,"editUrl":"https://github.com/cyzus/suzent/tree/main/website/../docs/02-concepts/automation/automation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Suzent Quickstart Guide","permalink":"/docs/getting-started/quickstart"},"next":{"title":"Filesystem & Execution","permalink":"/docs/concepts/filesystem"}}');var t=s(4848),r=s(8453);const d={},l="Suzent Automation Guide",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Cron Jobs",id:"cron-jobs",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Cron Expression Reference",id:"cron-expression-reference",level:3},{value:"Delivery Modes",id:"delivery-modes",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Managing Cron Jobs",id:"managing-cron-jobs",level:3},{value:"Settings UI",id:"settings-ui",level:4},{value:"CLI",id:"cli",level:4},{value:"REST API",id:"rest-api",level:4},{value:"Heartbeat",id:"heartbeat",level:2},{value:"How It Works",id:"how-it-works-1",level:3},{value:"HEARTBEAT.md",id:"heartbeatmd",level:3},{value:"Editing HEARTBEAT.md",id:"editing-heartbeatmd",level:4},{value:"Rules for the Agent During Heartbeat",id:"rules-for-the-agent-during-heartbeat",level:4},{value:"HEARTBEAT_OK Suppression",id:"heartbeat_ok-suppression",level:3},{value:"Managing Heartbeat",id:"managing-heartbeat",level:3},{value:"Settings UI",id:"settings-ui-1",level:4},{value:"CLI",id:"cli-1",level:4},{value:"REST API",id:"rest-api-1",level:4},{value:"Architecture",id:"architecture",level:2},{value:"Scheduler (Cron)",id:"scheduler-cron",level:3},{value:"Heartbeat",id:"heartbeat-1",level:3},{value:"Notification Flow",id:"notification-flow",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Server Lifecycle",id:"server-lifecycle",level:3},{value:"Model Resolution",id:"model-resolution",level:3},{value:"Memory",id:"memory",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Scheduler Not Running",id:"scheduler-not-running",level:3},{value:"Job Never Fires",id:"job-never-fires",level:3},{value:"Job Deactivated After Failures",id:"job-deactivated-after-failures",level:3},{value:"Heartbeat Won&#39;t Enable",id:"heartbeat-wont-enable",level:3},{value:"HEARTBEAT_OK Not Suppressing",id:"heartbeat_ok-not-suppressing",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"suzent-automation-guide",children:"Suzent Automation Guide"})}),"\n",(0,t.jsx)(n.p,{children:"This guide covers the automation systems in Suzent \u2014 scheduled cron jobs and periodic heartbeat check-ins."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Suzent has two separate automation systems that allow it to act proactively without user-initiated requests:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{}),(0,t.jsx)(n.th,{children:"Cron"}),(0,t.jsx)(n.th,{children:"Heartbeat"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Purpose"})}),(0,t.jsx)(n.td,{children:"Execute a specific task at a specific time"}),(0,t.jsx)(n.td,{children:'Periodic "wake up, check if anything needs attention"'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Session"})}),(0,t.jsxs)(n.td,{children:["Isolated (",(0,t.jsx)(n.code,{children:"cron-{id}"}),") \u2014 fresh, stateless"]}),(0,t.jsxs)(n.td,{children:["Persistent (",(0,t.jsx)(n.code,{children:"heartbeat-main"}),") \u2014 accumulates context"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Timing"})}),(0,t.jsx)(n.td,{children:"Cron expression (precise)"}),(0,t.jsx)(n.td,{children:"Fixed interval (default 30 min)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Config"})}),(0,t.jsx)(n.td,{children:"Per-job prompt"}),(0,t.jsxs)(n.td,{children:["Single ",(0,t.jsx)(n.code,{children:"/shared/HEARTBEAT.md"})," checklist"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Batching"})}),(0,t.jsx)(n.td,{children:"One job = one task"}),(0,t.jsx)(n.td,{children:"One tick can check multiple things"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Context"})}),(0,t.jsx)(n.td,{children:"No conversation history"}),(0,t.jsx)(n.td,{children:"Sees recent check history"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Cron when:"})," you want a scheduled action \u2014 daily reports, weekly summaries, timed reminders."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Heartbeat when:"}),' you want ambient monitoring \u2014 "check my inbox", "anything urgent?", "scan for problems". One heartbeat replaces many small cron jobs by batching checks in a single agent turn.']}),"\n",(0,t.jsx)(n.h2,{id:"cron-jobs",children:"Cron Jobs"}),"\n",(0,t.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"You describe what you want automated and how often"}),"\n",(0,t.jsx)(n.li,{children:"Job is created via Settings > Automation, CLI, or through the agent"}),"\n",(0,t.jsxs)(n.li,{children:["Scheduler fires the prompt in an isolated chat (",(0,t.jsx)(n.code,{children:"cron-{id}"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Results delivered via status bar (announce) or silently logged (none)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Each cron job runs in its own isolated chat session with no conversation history. Memory is disabled to avoid polluting the knowledge base with routine output."}),"\n",(0,t.jsx)(n.h3,{id:"cron-expression-reference",children:"Cron Expression Reference"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0-59)\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0-23)\n\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1-31)\n\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 month (1-12)\n\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of week (0-6, Sun=0)\n\u2502 \u2502 \u2502 \u2502 \u2502\n* * * * *\n"})}),"\n",(0,t.jsx)(n.p,{children:"Common patterns:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Expression"}),(0,t.jsx)(n.th,{children:"Schedule"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"*/5 * * * *"})}),(0,t.jsx)(n.td,{children:"Every 5 minutes"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 * * * *"})}),(0,t.jsx)(n.td,{children:"Every hour"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 9 * * *"})}),(0,t.jsx)(n.td,{children:"Daily at 9:00 AM"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 9 * * 1-5"})}),(0,t.jsx)(n.td,{children:"Weekdays at 9:00 AM"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 9,18 * * *"})}),(0,t.jsx)(n.td,{children:"Twice daily at 9 AM and 6 PM"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 0 * * 0"})}),(0,t.jsx)(n.td,{children:"Weekly on Sunday at midnight"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 0 1 * *"})}),(0,t.jsx)(n.td,{children:"First day of each month"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"delivery-modes",children:"Delivery Modes"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Mode"}),(0,t.jsx)(n.th,{children:"Behavior"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"announce"})}),(0,t.jsx)(n.td,{children:"Result appears in the status bar notification"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"none"})}),(0,t.jsx)(n.td,{children:"Result is logged silently (check via UI or CLI)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Failed jobs increment a retry counter"}),"\n",(0,t.jsxs)(n.li,{children:["After ",(0,t.jsx)(n.strong,{children:"5 consecutive failures"}),", the job is automatically deactivated"]}),"\n",(0,t.jsx)(n.li,{children:"Retry uses exponential backoff (base 60s)"}),"\n",(0,t.jsxs)(n.li,{children:["Check ",(0,t.jsx)(n.code,{children:"last_error"})," in the UI or CLI to diagnose issues"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"managing-cron-jobs",children:"Managing Cron Jobs"}),"\n",(0,t.jsx)(n.h4,{id:"settings-ui",children:"Settings UI"}),"\n",(0,t.jsxs)(n.p,{children:["Open ",(0,t.jsx)(n.strong,{children:"Settings > Automation"})," to:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"View scheduler status and job counts"}),"\n",(0,t.jsx)(n.li,{children:"Create new jobs with name, cron expression, prompt, delivery mode, and model override"}),"\n",(0,t.jsx)(n.li,{children:"Toggle jobs on/off, trigger immediate runs, or delete jobs"}),"\n",(0,t.jsx)(n.li,{children:"View last run time, next run time, results, and errors"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"cli",children:"CLI"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# List all jobs\nsuzent cron list [--verbose]\n\n# Add a new job\nsuzent cron add --name "daily-summary" --cron "0 9 * * *" --prompt "Summarize today\'s agenda"\n\n# Trigger a job immediately\nsuzent cron trigger <job_id>\n\n# Toggle a job on/off\nsuzent cron toggle <job_id>\n\n# Remove a job\nsuzent cron remove <job_id>\n\n# Show scheduler status\nsuzent cron status\n'})}),"\n",(0,t.jsx)(n.h4,{id:"rest-api",children:"REST API"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Endpoint"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"GET"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/jobs"})}),(0,t.jsx)(n.td,{children:"List all jobs"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/jobs"})}),(0,t.jsx)(n.td,{children:"Create a job"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PUT"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/jobs/{job_id}"})}),(0,t.jsx)(n.td,{children:"Update a job"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DELETE"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/jobs/{job_id}"})}),(0,t.jsx)(n.td,{children:"Delete a job"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/jobs/{job_id}/trigger"})}),(0,t.jsx)(n.td,{children:"Trigger immediate run"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"GET"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/status"})}),(0,t.jsx)(n.td,{children:"Scheduler health and job counts"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"GET"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/cron/notifications"})}),(0,t.jsx)(n.td,{children:"Drain pending announce notifications"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"heartbeat",children:"Heartbeat"}),"\n",(0,t.jsx)(n.h3,{id:"how-it-works-1",children:"How It Works"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a checklist at ",(0,t.jsx)(n.code,{children:"/shared/HEARTBEAT.md"})," (via Settings > Automation editor or file tools)"]}),"\n",(0,t.jsx)(n.li,{children:"Enable the heartbeat system"}),"\n",(0,t.jsxs)(n.li,{children:["HeartbeatRunner fires every 30 minutes in a persistent ",(0,t.jsx)(n.code,{children:"heartbeat-main"})," chat"]}),"\n",(0,t.jsx)(n.li,{children:"Agent reads the checklist, checks each item"}),"\n",(0,t.jsxs)(n.li,{children:["If nothing needs attention, agent replies ",(0,t.jsx)(n.code,{children:"HEARTBEAT_OK"})," (notification suppressed)"]}),"\n",(0,t.jsx)(n.li,{children:"If something is actionable, it surfaces via the status bar"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Unlike cron jobs, the heartbeat runs in a ",(0,t.jsx)(n.strong,{children:"persistent chat session"})," that accumulates context across ticks. This means the agent can see what it checked previously and avoid repeating stale information."]}),"\n",(0,t.jsx)(n.h3,{id:"heartbeatmd",children:"HEARTBEAT.md"}),"\n",(0,t.jsxs)(n.p,{children:["The checklist lives at ",(0,t.jsx)(n.code,{children:"/shared/HEARTBEAT.md"}),", alongside the memory workspace (",(0,t.jsx)(n.code,{children:"/shared/memory/"}),"). This location allows both the agent and the frontend to read and edit it."]}),"\n",(0,t.jsx)(n.p,{children:"Example checklist:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-markdown",children:"# Heartbeat Checklist\n\n- Quick scan: anything urgent in recent conversations?\n- If a task was left incomplete, note what is missing.\n- Check for any pending follow-ups.\n"})}),"\n",(0,t.jsxs)(n.p,{children:["An example template is provided at ",(0,t.jsx)(n.code,{children:"config/HEARTBEAT.example.md"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"editing-heartbeatmd",children:"Editing HEARTBEAT.md"}),"\n",(0,t.jsx)(n.p,{children:"There are three ways to edit the checklist:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Settings UI"})," \u2014 Open Settings > Automation, expand the HEARTBEAT.md editor in the heartbeat card"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Agent"})," \u2014 Ask the agent to edit ",(0,t.jsx)(n.code,{children:"/shared/HEARTBEAT.md"})," using file tools"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CLI/File system"})," \u2014 Edit the file directly at ",(0,t.jsx)(n.code,{children:"{sandbox_data_path}/shared/HEARTBEAT.md"})]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"rules-for-the-agent-during-heartbeat",children:"Rules for the Agent During Heartbeat"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Follow the checklist strictly"}),"\n",(0,t.jsx)(n.li,{children:"Do not infer or repeat old tasks from prior heartbeats"}),"\n",(0,t.jsxs)(n.li,{children:["Reply ",(0,t.jsx)(n.code,{children:"HEARTBEAT_OK"})," if nothing needs attention"]}),"\n",(0,t.jsx)(n.li,{children:"Keep responses concise \u2014 only surface actionable items"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"heartbeat_ok-suppression",children:"HEARTBEAT_OK Suppression"}),"\n",(0,t.jsxs)(n.p,{children:["When the agent determines nothing needs attention, it replies with ",(0,t.jsx)(n.code,{children:"HEARTBEAT_OK"}),". This response is suppressed from notifications to avoid noise. The suppression logic tolerates minor preamble text (up to 300 extra characters) around the sentinel."]}),"\n",(0,t.jsx)(n.h3,{id:"managing-heartbeat",children:"Managing Heartbeat"}),"\n",(0,t.jsx)(n.h4,{id:"settings-ui-1",children:"Settings UI"}),"\n",(0,t.jsxs)(n.p,{children:["The heartbeat card in ",(0,t.jsx)(n.strong,{children:"Settings > Automation"})," shows:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Current status (enabled/disabled/running)"}),"\n",(0,t.jsx)(n.li,{children:"Interval and whether HEARTBEAT.md exists"}),"\n",(0,t.jsx)(n.li,{children:"Enable/Disable toggle and Run Now button"}),"\n",(0,t.jsx)(n.li,{children:"Inline HEARTBEAT.md editor"}),"\n",(0,t.jsx)(n.li,{children:"Last run time, result, and errors"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"cli-1",children:"CLI"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Show heartbeat status\nsuzent heartbeat status\n\n# Enable heartbeat (requires HEARTBEAT.md to exist)\nsuzent heartbeat enable\n\n# Disable heartbeat\nsuzent heartbeat disable\n\n# Trigger an immediate heartbeat tick\nsuzent heartbeat run\n"})}),"\n",(0,t.jsx)(n.h4,{id:"rest-api-1",children:"REST API"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Endpoint"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"GET"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/heartbeat/status"})}),(0,t.jsx)(n.td,{children:"Heartbeat system status"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/heartbeat/enable"})}),(0,t.jsx)(n.td,{children:"Enable heartbeat"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/heartbeat/disable"})}),(0,t.jsx)(n.td,{children:"Disable heartbeat"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"POST"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/heartbeat/trigger"})}),(0,t.jsx)(n.td,{children:"Trigger immediate tick"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"GET"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/heartbeat/md"})}),(0,t.jsx)(n.td,{children:"Read HEARTBEAT.md content"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PUT"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/heartbeat/md"})}),(0,t.jsx)(n.td,{children:"Update HEARTBEAT.md content"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"scheduler-cron",children:"Scheduler (Cron)"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"SchedulerBrain"})," follows the same singleton pattern as ",(0,t.jsx)(n.code,{children:"SocialBrain"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SchedulerBrain   \u2502  tick every 30s\n\u2502  ._run_loop()     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n                                       \u25bc\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 Check due jobs   \u2502\n                              \u2502 (next_run_at <=  \u2502\n                              \u2502  now)            \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 _execute_job()   \u2502\n                              \u2502 Isolated chat    \u2502\n                              \u2502 cron-{job_id}    \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 Update DB state  \u2502\n                              \u2502 Push notification\u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h3,{id:"heartbeat-1",children:"Heartbeat"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"HeartbeatRunner"})," runs independently:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  HeartbeatRunner  \u2502  sleep(interval)\n\u2502  ._run_loop()     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n                                       \u25bc\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 Read HEARTBEAT.md\u2502\n                              \u2502 from /shared/    \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 Process turn in  \u2502\n                              \u2502 heartbeat-main   \u2502\n                              \u2502 (persistent)     \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 HEARTBEAT_OK?    \u2502\n                              \u2502 Yes \u2192 suppress   \u2502\n                              \u2502 No \u2192 notify      \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h3,{id:"notification-flow",children:"Notification Flow"}),"\n",(0,t.jsx)(n.p,{children:"Both systems deliver notifications through a shared mechanism:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Cron jobs with ",(0,t.jsx)(n.code,{children:'delivery_mode: "announce"'})," push results to an in-memory deque"]}),"\n",(0,t.jsx)(n.li,{children:"Heartbeat alerts route through the scheduler's notification deque via a callback"}),"\n",(0,t.jsxs)(n.li,{children:["Frontend polls ",(0,t.jsx)(n.code,{children:"GET /cron/notifications"})," every 5 seconds"]}),"\n",(0,t.jsx)(n.li,{children:"Notifications appear in the status bar"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"server-lifecycle",children:"Server Lifecycle"}),"\n",(0,t.jsxs)(n.p,{children:["Both systems start during server initialization (",(0,t.jsx)(n.code,{children:"init_background_services()"}),") and stop during shutdown:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SchedulerBrain"})," \u2014 ticks every 30 seconds, checking for due jobs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HeartbeatRunner"})," \u2014 sleeps for the configured interval (default 30 minutes)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"model-resolution",children:"Model Resolution"}),"\n",(0,t.jsx)(n.p,{children:"Both systems resolve which LLM model to use in this order:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Job-level ",(0,t.jsx)(n.code,{children:"model_override"})," (cron only)"]}),"\n",(0,t.jsx)(n.li,{children:"User preferences model (from settings)"}),"\n",(0,t.jsx)(n.li,{children:"System default"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"memory",children:"Memory"}),"\n",(0,t.jsxs)(n.p,{children:["Memory is ",(0,t.jsx)(n.strong,{children:"disabled"})," for both cron and heartbeat executions to avoid polluting the knowledge base with routine automated output."]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"scheduler-not-running",children:"Scheduler Not Running"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," ",(0,t.jsx)(n.code,{children:"GET /cron/status"})," shows ",(0,t.jsx)(n.code,{children:"scheduler_running: false"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Check server logs for startup errors"}),"\n",(0,t.jsxs)(n.li,{children:["Verify ",(0,t.jsx)(n.code,{children:"croniter"})," is installed (",(0,t.jsx)(n.code,{children:"pip show croniter"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Restart the server"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"job-never-fires",children:"Job Never Fires"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," Job exists but ",(0,t.jsx)(n.code,{children:"last_run_at"})," stays null"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Check ",(0,t.jsx)(n.code,{children:"active"})," is ",(0,t.jsx)(n.code,{children:"true"})]}),"\n",(0,t.jsx)(n.li,{children:"Verify cron expression is valid"}),"\n",(0,t.jsxs)(n.li,{children:["Check ",(0,t.jsx)(n.code,{children:"next_run_at"})," \u2014 is it in the future?"]}),"\n",(0,t.jsx)(n.li,{children:"Look for errors in server logs"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"job-deactivated-after-failures",children:"Job Deactivated After Failures"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," Job was auto-deactivated after 5 failures"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Check ",(0,t.jsx)(n.code,{children:"last_error"})," for the failure reason"]}),"\n",(0,t.jsx)(n.li,{children:"Fix the underlying issue (model auth, prompt errors, etc.)"}),"\n",(0,t.jsxs)(n.li,{children:["Re-enable the job via toggle in UI or ",(0,t.jsx)(n.code,{children:"suzent cron toggle <id>"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"heartbeat-wont-enable",children:"Heartbeat Won't Enable"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"}),' "HEARTBEAT.md not found" error']}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create ",(0,t.jsx)(n.code,{children:"/shared/HEARTBEAT.md"})," via the Settings editor or file tools"]}),"\n",(0,t.jsxs)(n.li,{children:["Copy the template: ",(0,t.jsx)(n.code,{children:"config/HEARTBEAT.example.md"})]}),"\n",(0,t.jsx)(n.li,{children:"Ensure the file has meaningful content (not just headers)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"heartbeat_ok-not-suppressing",children:"HEARTBEAT_OK Not Suppressing"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," Getting notifications even when agent says HEARTBEAT_OK"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Ensure the agent's response contains exactly ",(0,t.jsx)(n.code,{children:"HEARTBEAT_OK"})," (case-sensitive)"]}),"\n",(0,t.jsx)(n.li,{children:"Extra text around the sentinel must be under 300 characters"}),"\n",(0,t.jsx)(n.li,{children:"Check that the response isn't wrapped in markdown formatting"}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);