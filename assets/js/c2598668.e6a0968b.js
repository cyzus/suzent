"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[74],{237(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"concepts/memory/architecture","title":"Architecture","description":"System Layers","source":"@site/../docs/02-concepts/memory/architecture.md","sourceDirName":"02-concepts/memory","slug":"/concepts/memory/architecture","permalink":"/docs/concepts/memory/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/cyzus/suzent/tree/main/website/../docs/02-concepts/memory/architecture.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"API Reference","permalink":"/docs/concepts/memory/api"},"next":{"title":"Configuration","permalink":"/docs/concepts/memory/configuration"}}');var i=s(4848),o=s(8453);const t={},c="Architecture",l={},a=[{value:"System Layers",id:"system-layers",level:2},{value:"Storage Tiers",id:"storage-tiers",level:2},{value:"Markdown Files (<code>/shared/memory/</code>)",id:"markdown-files-sharedmemory",level:3},{value:"LanceDB (<code>.suzent/memory/</code>)",id:"lancedb-suzentmemory",level:3},{value:"Session Data (<code>.suzent/</code>)",id:"session-data-suzent",level:3},{value:"Components",id:"components",level:2},{value:"MarkdownMemoryStore (markdown_store.py)",id:"markdownmemorystore-markdown_storepy",level:3},{value:"LanceDBMemoryStore (lancedb_store.py)",id:"lancedbmemorystore-lancedb_storepy",level:3},{value:"MemoryManager (manager.py)",id:"memorymanager-managerpy",level:3},{value:"MarkdownIndexer (indexer.py)",id:"markdownindexer-indexerpy",level:3},{value:"TranscriptIndexer (indexer.py)",id:"transcriptindexer-indexerpy",level:3},{value:"ContextCompressor (context_compressor.py)",id:"contextcompressor-context_compressorpy",level:3},{value:"Memory Tools (tools.py)",id:"memory-tools-toolspy",level:3},{value:"Memory Context (memory_context.py)",id:"memory-context-memory_contextpy",level:3},{value:"Session Components",id:"session-components",level:2},{value:"TranscriptManager (session/transcript.py)",id:"transcriptmanager-sessiontranscriptpy",level:3},{value:"StateMirror (session/state_mirror.py)",id:"statemirror-sessionstate_mirrorpy",level:3},{value:"SessionLifecycle (session/lifecycle.py)",id:"sessionlifecycle-sessionlifecyclepy",level:3},{value:"Agent Serializer (core/agent_serializer.py)",id:"agent-serializer-coreagent_serializerpy",level:3},{value:"Data Flow",id:"data-flow",level:2},{value:"Write Path (Extraction + Dual-Write)",id:"write-path-extraction--dual-write",level:3},{value:"Read Path (Memory Injection)",id:"read-path-memory-injection",level:3},{value:"Pre-Compaction Flush",id:"pre-compaction-flush",level:3},{value:"Session Lifecycle",id:"session-lifecycle",level:3},{value:"Memory Scoping",id:"memory-scoping",level:2},{value:"User-Level",id:"user-level",level:3},{value:"Chat-Level",id:"chat-level",level:3},{value:"Global",id:"global",level:3},{value:"Priority",id:"priority",level:3},{value:"File Structure",id:"file-structure",level:2},{value:"Data Layout",id:"data-layout",level:2},{value:"Design Principles",id:"design-principles",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,i.jsx)(n.h2,{id:"system-layers",children:"System Layers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Agent Tools                \u2502  memory_search, memory_block_update\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      MemoryManager              \u2502  Orchestration & extraction\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  LanceDB    \u2502  MarkdownStore    \u2502  Dual-write storage\n\u2502  (search)   \u2502  (source of truth)\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      Session Layer              \u2502  Transcripts, state, lifecycle\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"storage-tiers",children:"Storage Tiers"}),"\n",(0,i.jsxs)(n.h3,{id:"markdown-files-sharedmemory",children:["Markdown Files (",(0,i.jsx)(n.code,{children:"/shared/memory/"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Human-readable source of truth."})," Agent-facing \u2014 the agent can read/write these files directly via ",(0,i.jsx)(n.code,{children:"ReadFileTool"}),"/",(0,i.jsx)(n.code,{children:"WriteFileTool"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Daily logs"})," (",(0,i.jsx)(n.code,{children:"YYYY-MM-DD.md"}),"): Append-only, timestamped facts per conversation turn"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MEMORY.md"}),": Curated long-term summary, auto-updated by ",(0,i.jsx)(n.code,{children:"refresh_core_memory_facts()"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"lancedb-suzentmemory",children:["LanceDB (",(0,i.jsx)(n.code,{children:".suzent/memory/"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Vector search index."})," Rebuilt from markdown if corrupted via ",(0,i.jsx)(n.code,{children:"MarkdownIndexer.reindex_from_markdown()"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Core memory blocks (persona, user, facts, context)"}),"\n",(0,i.jsx)(n.li,{children:"Archival memories with vector embeddings"}),"\n",(0,i.jsx)(n.li,{children:"Hybrid search: semantic + full-text + importance + recency"}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"session-data-suzent",children:["Session Data (",(0,i.jsx)(n.code,{children:".suzent/"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Internal operational data."})," Not agent-facing \u2014 accessed via API endpoints."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transcripts"})," (",(0,i.jsx)(n.code,{children:".suzent/transcripts/{id}.jsonl"}),"): Append-only per-session conversation logs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"State snapshots"})," (",(0,i.jsx)(n.code,{children:".suzent/state/{id}.json"}),"): Inspectable JSON agent state mirrors"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,i.jsx)(n.h3,{id:"markdownmemorystore-markdown_storepy",children:"MarkdownMemoryStore (markdown_store.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Human-readable persistence layer"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Manages files in ",(0,i.jsx)(n.code,{children:"/shared/memory/"})," (cross-session, agent-accessible)"]}),"\n",(0,i.jsxs)(n.li,{children:["Daily log format: lean single-line-per-fact (",(0,i.jsx)(n.code,{children:"- [category] content \\"}),"tag1 tag2``)"]}),"\n",(0,i.jsxs)(n.li,{children:["Methods: ",(0,i.jsx)(n.code,{children:"append_daily_log()"}),", ",(0,i.jsx)(n.code,{children:"get_recent_logs()"}),", ",(0,i.jsx)(n.code,{children:"write_memory_file()"}),", ",(0,i.jsx)(n.code,{children:"read_memory_file()"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"lancedbmemorystore-lancedb_storepy",children:"LanceDBMemoryStore (lancedb_store.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Search index layer"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"LanceDB connection management"}),"\n",(0,i.jsx)(n.li,{children:"Core memory block CRUD with scoping priority (chat > user > global)"}),"\n",(0,i.jsx)(n.li,{children:"Archival memory with vector embeddings"}),"\n",(0,i.jsx)(n.li,{children:"Semantic and hybrid search"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"memorymanager-managerpy",children:"MemoryManager (manager.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Orchestration layer"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dual-write"}),": every extracted fact goes to both LanceDB and markdown"]}),"\n",(0,i.jsx)(n.li,{children:"Automatic LLM-based fact extraction (one concise sentence per fact)"}),"\n",(0,i.jsx)(n.li,{children:"Deduplication via similarity threshold (0.85)"}),"\n",(0,i.jsx)(n.li,{children:"Core memory refresh when high-importance facts are found"}),"\n",(0,i.jsxs)(n.li,{children:["Transcript linkage: facts track ",(0,i.jsx)(n.code,{children:"source_session_id"}),", ",(0,i.jsx)(n.code,{children:"source_transcript_line"}),", ",(0,i.jsx)(n.code,{children:"source_timestamp"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"markdownindexer-indexerpy",children:"MarkdownIndexer (indexer.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recovery mechanism"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"reindex_from_markdown()"}),": Rebuilds LanceDB from markdown daily logs"]}),"\n",(0,i.jsx)(n.li,{children:"Parses facts from markdown format, generates embeddings, stores in LanceDB"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"transcriptindexer-indexerpy",children:"TranscriptIndexer (indexer.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cross-session search"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Chunks JSONL transcripts (~400 tokens, 80 overlap) into LanceDB"}),"\n",(0,i.jsx)(n.li,{children:"Enables semantic search across past session conversations"}),"\n",(0,i.jsxs)(n.li,{children:["Opt-in via ",(0,i.jsx)(n.code,{children:"transcript_indexing_enabled"})," config"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"contextcompressor-context_compressorpy",children:"ContextCompressor (context_compressor.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Context window management with pre-compaction flush"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Before compressing steps, extracts facts from steps about to be removed"}),"\n",(0,i.jsxs)(n.li,{children:["Feeds synthetic ",(0,i.jsx)(n.code,{children:"ConversationTurn"})," to ",(0,i.jsx)(n.code,{children:"MemoryManager"})," for dual-write"]}),"\n",(0,i.jsx)(n.li,{children:"Ensures no valuable context is lost when the context window is trimmed"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"memory-tools-toolspy",children:"Memory Tools (tools.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Agent interface"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MemorySearchTool"}),": Semantic search across archival memory"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MemoryBlockUpdateTool"}),": Update core blocks (replace, append, search_replace)"]}),"\n",(0,i.jsxs)(n.li,{children:["Thread-safe via ",(0,i.jsx)(n.code,{children:"asyncio.run_coroutine_threadsafe()"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"memory-context-memory_contextpy",children:"Memory Context (memory_context.py)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Prompt templates"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FACT_EXTRACTION_SYSTEM_PROMPT"}),": One concise sentence per fact, no filler"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CORE_MEMORY_SUMMARIZATION_PROMPT"}),": Max 200 words, bullet points only"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"format_core_memory_section()"}),": Includes Memory Workspace location (",(0,i.jsx)(n.code,{children:"/shared/memory/"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"format_retrieved_memories_section()"}),": Single-line format per memory"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"session-components",children:"Session Components"}),"\n",(0,i.jsx)(n.h3,{id:"transcriptmanager-sessiontranscriptpy",children:"TranscriptManager (session/transcript.py)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Append-only JSONL files at ",(0,i.jsx)(n.code,{children:".suzent/transcripts/{session_id}.jsonl"})]}),"\n",(0,i.jsxs)(n.li,{children:["Each line: ",(0,i.jsx)(n.code,{children:'{"ts", "role", "content", "actions", "meta"}'})]}),"\n",(0,i.jsx)(n.li,{children:"Thread-safe with async locks per session"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"statemirror-sessionstate_mirrorpy",children:"StateMirror (session/state_mirror.py)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Writes inspectable JSON snapshots to ",(0,i.jsx)(n.code,{children:".suzent/state/{session_id}.json"})]}),"\n",(0,i.jsx)(n.li,{children:"Parses JSON v2 agent state; writes placeholder for legacy pickle"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"sessionlifecycle-sessionlifecyclepy",children:"SessionLifecycle (session/lifecycle.py)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SessionPolicy"}),": daily reset hour, idle timeout, max turns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"should_reset()"}),": checks all policies against session metadata"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"agent-serializer-coreagent_serializerpy",children:"Agent Serializer (core/agent_serializer.py)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"JSON v2 format"}),": Human-readable, inspectable agent state"]}),"\n",(0,i.jsx)(n.li,{children:"Backward-compatible: auto-detects and loads legacy pickle format"}),"\n",(0,i.jsx)(n.li,{children:"Serializes smolagents step objects (ActionStep, PlanningStep, TaskStep, FinalAnswerStep)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,i.jsx)(n.h3,{id:"write-path-extraction--dual-write",children:"Write Path (Extraction + Dual-Write)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Conversation Turn (User + Agent + Response)\n  \u2193\nmanager.process_conversation_turn_for_memories()\n  \u2193\nLLM extracts concise facts\n  \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 LanceDB store  \u2502 Markdown daily log  \u2502\n\u2502 (search index) \u2502 (source of truth)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  \u2193\nIf High Importance \u2192 refresh_core_memory_facts() \u2192 MEMORY.md\n"})}),"\n",(0,i.jsx)(n.h3,{id:"read-path-memory-injection",children:"Read Path (Memory Injection)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User Query\n  \u2193\nmanager.retrieve_relevant_memories()\n  \u2193\nGenerate embedding \u2192 Hybrid search (LanceDB)\n  \u2193\nFormat results (single-line per memory)\n  \u2193\nInject into agent prompt\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pre-compaction-flush",children:"Pre-Compaction Flush"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Context compression triggered\n  \u2193\n_pre_compaction_flush(steps_to_compress)\n  \u2193\nBuild synthetic ConversationTurn from steps\n  \u2193\nFeed to memory extraction pipeline (dual-write)\n  \u2193\nCompress steps into summary\n"})}),"\n",(0,i.jsx)(n.h3,{id:"session-lifecycle",children:"Session Lifecycle"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"New message arrives\n  \u2193\nWrite JSONL transcript entry\n  \u2193\nExtract memories (dual-write)\n  \u2193\nCheck compression \u2192 pre-compaction flush if needed\n  \u2193\nPersist state (JSON v2 + StateMirror)\n  \u2193\nUpdate last_active_at, turn_count\n"})}),"\n",(0,i.jsx)(n.h2,{id:"memory-scoping",children:"Memory Scoping"}),"\n",(0,i.jsx)(n.h3,{id:"user-level",children:"User-Level"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope:"})," All chats"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage:"})," ",(0,i.jsx)(n.code,{children:'user_id="x", chat_id=NULL'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use:"})," Preferences, facts, persona"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"chat-level",children:"Chat-Level"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope:"})," Single conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage:"})," ",(0,i.jsx)(n.code,{children:'user_id="x", chat_id="y"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use:"})," Current context, session state"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"global",children:"Global"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope:"})," All users/chats"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage:"})," ",(0,i.jsx)(n.code,{children:"user_id=NULL, chat_id=NULL"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use:"})," Default persona"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"priority",children:"Priority"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Chat-specific (most specific)"}),"\n",(0,i.jsx)(n.li,{children:"User-level (persistent)"}),"\n",(0,i.jsx)(n.li,{children:"Global (fallback)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"src/suzent/memory/\n\u251c\u2500\u2500 __init__.py          # Exports\n\u251c\u2500\u2500 lancedb_store.py     # LanceDB search index\n\u251c\u2500\u2500 markdown_store.py    # Markdown source of truth (/shared/memory/)\n\u251c\u2500\u2500 indexer.py           # MarkdownIndexer + TranscriptIndexer\n\u251c\u2500\u2500 manager.py           # Orchestration & dual-write\n\u251c\u2500\u2500 memory_context.py    # Prompt templates\n\u251c\u2500\u2500 tools.py             # Agent tools\n\u251c\u2500\u2500 models.py            # Pydantic models\n\u2514\u2500\u2500 lifecycle.py         # Initialization\n\nsrc/suzent/session/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 transcript.py        # JSONL transcripts\n\u251c\u2500\u2500 state_mirror.py      # Agent state snapshots\n\u2514\u2500\u2500 lifecycle.py         # Session reset policies\n\nsrc/suzent/core/\n\u251c\u2500\u2500 agent_serializer.py  # JSON v2 agent state\n\u251c\u2500\u2500 context_compressor.py # Pre-compaction flush\n\u2514\u2500\u2500 chat_processor.py    # Integration point\n\nsrc/suzent/routes/\n\u2514\u2500\u2500 session_routes.py    # Transcript/state/memory APIs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"data-layout",children:"Data Layout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"data/sandbox-data/\n  shared/                           # Cross-session workspace (agent sees /shared/)\n    memory/\n      MEMORY.md                     # Curated long-term memory\n      2026-02-08.md                 # Daily append-only logs\n\n.suzent/\n  chats.db                          # SQLite + session lifecycle fields\n  memory/                           # LanceDB search index\n  transcripts/\n    {session_id}.jsonl              # Per-session conversation logs\n  state/\n    {session_id}.json               # Agent state snapshots\n"})}),"\n",(0,i.jsx)(n.h2,{id:"design-principles",children:"Design Principles"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Markdown as Source of Truth"})," - Human-readable, git-friendly, recoverable"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dual-Write"})," - Every fact persisted to both markdown and LanceDB"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Context Loss"})," - Pre-compaction flush captures facts before compression"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inspectable State"})," - JSON v2 replaces opaque pickle; state mirrors on disk"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Separation of Concerns"})," - Agent-facing (",(0,i.jsx)(n.code,{children:"/shared/"}),") vs internal (",(0,i.jsx)(n.code,{children:".suzent/"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Async by Default"})," - Non-blocking I/O throughout"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backward Compatible"})," - Legacy pickle deserialization, nullable migrations"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);